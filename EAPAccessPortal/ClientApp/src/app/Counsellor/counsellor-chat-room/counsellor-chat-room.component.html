<div *ngIf="isLoad" class="loader-overlay">
  <div class="loader1"></div>
</div>
  <div class="group-hd">
    <!-- <ul class="top-bar order-md-1" [ngClass]="{ 'disbleclass': ChatstartSubmitted}">
      <li><a href="javascript:;"><img src="/assets/images/phone-call.svg" alt="phone call"> 1800 818 728</a></li>
      <li><a href="make-a-booking.html"><img src="/assets/images/calendar-alt.svg" alt="Make a booking"> Make a
          booking</a></li>
      <li><a href="javascript:;" routerLink="/dashboard/chatroom"><img src="/assets/images/chat.svg" alt="Instant Chat"> Instant Chat</a></li>
    </ul> -->
    <h1>Chat Room</h1>
  </div>

  <div class="chat-main">
    <div class="row">
      <div class="col-md-6">
        <div class="chat-box">
          <div class="online-user" *ngIf="ACEAppointmentId!=undefined">
            <div class="user-frame">
              <div class="user-img">

                <span class="user-active">&nbsp;</span>
                <figure> <img [src]="currentLiveChatAppts.ClientProfilePhoto" onError="this.onerror=null;this.src='/assets/images/defaultprofile_b.png';"  *ngIf="currentLiveChatAppts.ClientProfilePhoto!=null" style="min-height: 45px;object-fit:cover;">
                  <img src="/assets/images/defaultprofile_b.png"  class="img-thumnail" *ngIf="((currentLiveChatAppts.ClientProfilePhoto==null)||(currentLiveChatAppts.ClientProfilePhoto==undefined))">
                 </figure>
              </div>
              <div class="name-desig">
                <h2 *ngIf=!currentLiveChatAppts.IsForFamilyMember>{{currentUser.RoleId==5?currentLiveChatAppts.Username:currentLiveChatAppts.CounsellorName}}</h2>
                <h2 *ngIf=currentLiveChatAppts.IsForFamilyMember>{{currentLiveChatAppts.FMFirstName}}</h2>
                <h3>{{currentUser.RoleId==5?'EAP Client':'EAP Counsellor'}}</h3>
              </div>
              <div class="chat-dropdown">
                <a href="#" data-toggle="dropdown">
                  <span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>
                </a>
                <div class="dropdown-menu">
                  <a  *ngIf="messages.length!=0" class="dropdown-item" href="javascript:;" (click)="EndChatSession(ACEAppointmentId)">End Chat Session</a>
                  <a class="dropdown-item user-modal" href="javascript:;">See User Profile</a>
                  <!-- <a href="#" class="btn blue-btn user-modal">See User Profile</a> -->
                  <!-- <a class="dropdown-item" href="#">Session</a> -->
                </div>
              </div>
            </div>
          </div>

    <!-- <div class="message-area" *ngIf="ACEAppointmentId==undefined"> -->
      <!-- <div *ngIf="isListView"> -->
        <div class="message-area"  *ngIf="ACEAppointmentId==undefined">
          <div class="nano">
               <div class="nano-content">
                <div [ngClass]="currentUser.UserId==msg.senderId?'right-chat':'left-chat'"
                *ngFor="let msg of messages">

                 <div [ngClass]="currentUser.UserId==msg.senderId?'r-img':'l-img'"><img
                     src="/assets/images/avtar-rectangle.png"></div>
                 <div [ngClass]="currentUser.UserId==msg.senderId?'r-chat':'l-chat'">
                   <div [ngClass]="currentUser.UserId==msg.senderId?'r-msg':'l-msg'">
                     {{msg.text}}</div>
                   <span>{{msg.date | date:'dd-MM-yyyy h:mm a'}}</span>
                 </div>
               </div>
                 <div *ngIf="isListView">
                  <div class="office-hr" style="margin-top: 18px !important">
                    <p>Our office hours are from 8:00 am to 8:00 pm AEST. </p>
                  </div>
                <div class="left-chat">

                      <div class="l-chat">
                        <div class="l-msg" style="font-size: 15px;">Thank you for your trust and interest in speaking with one of our counsellors. The intended purpose of this chat session is to do XYZ. Thank you for your trust and interest in speaking with one of our counsellors.</div>
                      </div>
                  </div>

                  <div class="left-chat">

                      <div class="l-chat">
                        <div class="l-msg" style="font-size: 15px;">Is this a crisis or a life threatening situation? If so, please contact this number <strong>000 2131 000</strong>.</div>
                      </div>
                  </div>
                  <div class="cnt-chat">
                    <a  class="btn appoint-btn" (click)="sendcontinue()">Continue to Chat</a>
                  </div>
                 </div>

                   <div *ngIf="!isListView">
                    <div class="office-hr m-0 text-center" style="padding-top:20%">
                      One moment, we are connecting you to a counsellor
                        <div class="chat-loader">
                          <div class="dot-flashing"></div>
                         </div>
                    </div>
                    <div class="chat-area">
                      <!-- <div class="emoji-section">

                        <i class='attachment' (click)="toggled = !toggled" [(emojiPickerIf)]="toggled"
                          [emojiPickerDirection]="'top'" (emojiPickerSelect)="handleSelection($event)"> <a
                            href="javascript:;"><img src="/assets/images/emoji.png" alt="Emoji" /></a> </i>

                      </div> -->
                      <div class="form-group chat-field">
                        <input type="text" [(ngModel)]="message.text" (keyup)="$event.keyCode == 13 && sendMessageinstant()"
                          placeholder="Type a message" class="form-control" />
                        <input (click)="sendMessageinstant()" type="button" value="submit" class="btn" />
                      </div>
                    </div>
                   </div>

               </div>
           </div>
       </div>
      <!-- </div> -->

          <!-- <div class="message-area" > -->
            <div class="message-area" *ngIf="ACEAppointmentId!=undefined">
              <div class="nano">
                <div class="nano-content">
                  <div [ngClass]="currentUser.UserId==msg.senderId?'right-chat':'left-chat'"
                   *ngFor="let msg of messages">

                    <div [ngClass]="currentUser.UserId==msg.senderId?'r-img':'l-img'"><img  *ngIf="currentUser.UserId==msg.senderId" [src]="currentLiveChatAppts.CounsollerProfilePhoto" onError="this.onerror=null;this.src='/assets/images/defaultprofile_b.png';"  > <img  *ngIf="currentUser.UserId!=msg.senderId" [src]="currentLiveChatAppts.ClientProfilePhoto" onError="this.onerror=null;this.src='/assets/images/defaultprofile_b.png';" ></div>
                    <div [ngClass]="currentUser.UserId==msg.senderId?'r-chat':'l-chat'">
                      <div [ngClass]="currentUser.UserId==msg.senderId?'r-msg':'l-msg'">
                        {{msg.text}}</div>
                      <span>{{msg.date | date:'dd-MM-yyyy h:mm a'}}</span>
                    </div>
                  </div>
                  <div *ngIf="messages.length==0" class="messageChat">
                     <div *ngIf="currentLiveChatAppts.EndDateDiffMins > 0 ">

  <div _ngcontent-c2="" class="messageChat" *ngIf="currentLiveChatAppts.StartDateDiffMins < 10  || currentLiveChatAppts.StartDateDiffMins==10">{{StatingMsg}}
    <div _ngcontent-c2="" class="white-dot black-dot">
      <span _ngcontent-c2="">&nbsp;</span>
      <span _ngcontent-c2="">&nbsp;</span>
      <span _ngcontent-c2="">&nbsp;</span>
  </div></div>
  </div>

  <div _ngcontent-c2="" class="messageChat" *ngIf="currentLiveChatAppts.StartDateDiffMins > 10">   Your appointment is scheduled for  {{currentLiveChatAppts.startDate}} {{currentLiveChatAppts.startTime}}
    <div _ngcontent-c2="" class="white-dot black-dot">
      <span _ngcontent-c2="">&nbsp;</span>
      <span _ngcontent-c2="">&nbsp;</span>
      <span _ngcontent-c2="">&nbsp;</span>
  </div></div>

  <div *ngIf="currentLiveChatAppts.StartDateDiffMins < 0 ">
    <div _ngcontent-c2="" class="messageChat" *ngIf="currentLiveChatAppts.DurationMins < currentLiveChatAppts.StartDateDiffMinsposite">  You appointment time is completed.
      <div _ngcontent-c2="" class="white-dot black-dot">
        <span _ngcontent-c2="">&nbsp;</span>
        <span _ngcontent-c2="">&nbsp;</span>
        <span _ngcontent-c2="">&nbsp;</span>
    </div></div>

  </div>
<!-- <div _ngcontent-c2="" class="messageChat" *ngIf="currentLiveChatAppts.IsCompleted==1">  You appointment time is completed.
  <div _ngcontent-c2="" class="white-dot black-dot">
    <span _ngcontent-c2="">&nbsp;</span>
    <span _ngcontent-c2="">&nbsp;</span>
    <span _ngcontent-c2="">&nbsp;</span>
</div></div> -->
<!-- <div *ngIf="currentLiveChatAppts.IsStarted==1 && currentLiveChatAppts.IsCompleted==0">
  Your appointment is alreday started
</div> -->

<!-- <div _ngcontent-c2="" class="messageChat" *ngIf="currentLiveChatAppts.IsStarted==1 && currentLiveChatAppts.IsCompleted==0"> Your appointment is already started.
  <div _ngcontent-c2="" class="white-dot black-dot">
    <span _ngcontent-c2="">&nbsp;</span>
    <span _ngcontent-c2="">&nbsp;</span>
    <span _ngcontent-c2="">&nbsp;</span>
</div></div> -->
                    <!-- Your {{currentUser.RoleId==5?'Client':'Counsellor'}}, {{currentUser.RoleId==5?currentLiveChatAppts.Username:currentLiveChatAppts.CounsellorName}} has not joined yet. -->


                    <!-- <div class="session-dropdown">
                      <a href="#" data-toggle="dropdown" style="float: left;
        margin-left: 114px;">
                        <span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>
                      </a>
                    </div> -->
                  </div>

                </div>
              </div>
            </div>

            <div class="chat-area" *ngIf="ACEAppointmentId!=undefined">

              <!-- <div class="emoji-section" [ngClass]="{ 'disbleclass': !Connectedcounsoller}">

                <i class='attachment' (click)="toggled = !toggled" [(emojiPickerIf)]="toggled"
                  [emojiPickerDirection]="'top'" (emojiPickerSelect)="handleSelection($event)"> <a
                    href="javascript:;"><img src="/assets/images/emoji.png" alt="Emoji" /></a> </i>

              </div> -->
              <div *ngIf="Appoitmenttimeovertime">Your Appointment Time is Over</div>
              <div *ngIf="Chatendyourclient">Looks like your chat session has ended</div>
              <div *ngIf="currentLiveChatAppts.EndDateDiffMins > 0 ">
                <div *ngIf="currentLiveChatAppts.StartDateDiffMins < 10 || currentLiveChatAppts.StartDateDiffMins==10">
                  <div *ngIf="!Appoitmenttimeovertime">
                  <div class="form-group chat-field" [ngClass]="{ 'disbleclass': !Connectedcounsoller}">
                    <input type="text" [ngClass]="{ 'disbleclass': !Connectedcounsoller}" id="textvalfornow"  [(ngModel)]="message.text" (keydown)="Typingshowfunction()"  (keyup)="$event.keyCode == 13 && sendMessage()"
                      placeholder="Type a message" class="form-control" />
                    <input  (click)="sendMessage()" type="button" value="submit" class="btn" />
                  </div>
                </div>
                <div *ngIf="Appoitmenttimeovertime">
                  <div class="form-group chat-field" [ngClass]="{ 'disbleclass': !Connectedcounsoller}">
                    <input type="text" [ngClass]="{ 'disbleclass': !Connectedcounsoller}" id="textvalfornow"  [(ngModel)]="message.text" (keydown)="Typingshowfunction()"  (keyup)="$event.keyCode == 13 && sendMessage()"
                      placeholder="Type a message" class="form-control" />
                    <input  (click)="sendMessage()" type="button" value="submit" class="btn" />
                  </div>
                </div>
                </div>
              </div>
              <div *ngIf="Chatstarttyping &&!currentLiveChatAppts.IsForFamilyMember">{{currentUser.RoleId==5?currentLiveChatAppts.Username:currentLiveChatAppts.CounsellorName}} Typing</div>
              <div *ngIf="Chatstarttyping &&currentLiveChatAppts.IsForFamilyMember">{{currentUser.RoleId==5?currentLiveChatAppts.FMFirstName:currentLiveChatAppts.CounsellorName}} Typing</div>


              <div *ngIf="currentLiveChatAppts.StartDateDiffMins > 10">
              <div class="form-group chat-field">
                <input type="text"  disabled [(ngModel)]="message.text" (keyup)="$event.keyCode == 13 && sendMessage()"
                  placeholder="Type a message" class="form-control" />
                <input disabled (click)="sendMessage()" type="button" value="submit" class="btn" />
              </div>
          </div>
          <div *ngIf="currentLiveChatAppts.StartDateDiffMins < 0 ">
            <div *ngIf="currentLiveChatAppts.DurationMins < currentLiveChatAppts.StartDateDiffMinsposite">
              <div class="form-group chat-field">
                <input type="text"  disabled [(ngModel)]="message.text" (keyup)="$event.keyCode == 13 && sendMessage()"
                  placeholder="Type a message" class="form-control" />
                <input disabled (click)="sendMessage()" type="button" value="submit" class="btn" />
              </div>
            </div>
          </div>
          <!-- <div *ngIf="currentLiveChatAppts.IsCompleted==1">
            <div class="form-group chat-field">
              <input type="text"  disabled [(ngModel)]="message.text" (keyup)="$event.keyCode == 13 && sendMessage()"
                placeholder="Type a message" class="form-control" />
              <input disabled (click)="sendMessage()" type="button" value="submit" class="btn" />
            </div>
        </div> -->
        <!-- <div *ngIf="currentLiveChatAppts.IsStarted==1 && currentLiveChatAppts.IsCompleted==0">
            <div class="form-group chat-field">
              <input type="text" disabled [(ngModel)]="message.text" (keyup)="$event.keyCode == 13 && sendMessage()"
                placeholder="Type a message" class="form-control" />
              <input  (click)="sendMessage()" type="button" value="submit" class="btn" />
          </div>
        </div> -->
            </div>
          </div>
        </div>


      <div class="col-md-6 position-relative">
        <!-- <div>
                    <a href="#" class="btn blue-btn">End Chat Session</a>
                </div>
                <div>
                    <a href="#" class="btn blue-btn user-modal">See User Profile</a>
                </div>  -->

        <div id="profile-modal" class="profile-modal" style="display:none;">
          <a class="close-modal"><img src="/assets/images/close-circle.svg" alt="close"></a>
          <div class="pm-user-avtar">
            <span class="user-active">&nbsp;</span>
            <img [src]="currentLiveChatAppts.ClientProfilePhoto" onError="this.onerror=null;this.src='/assets/images/defaultprofile_b.png';"  class="img-thumnail"  *ngIf="currentLiveChatAppts.ClientProfilePhoto!=null">
          </div>
          <ul *ngIf=!currentLiveChatAppts.IsForFamilyMember>
            <li><span>{{currentUser.RoleId==5?currentLiveChatAppts.Username:currentLiveChatAppts.CounsellorName}}</span></li>
            <li>Employer: <span>{{currentUser.RoleId==5?currentLiveChatAppts.ClientOrganisationName:currentLiveChatAppts.CounsellerOrganisationName}}</span></li>
            <li>Group: <span>{{currentLiveChatAppts.GroupName}}</span></li>
            <li>Division: <span>{{currentLiveChatAppts.DivisionName}}</span></li>
            <li>Department: <span>{{currentLiveChatAppts.DepartmentName}}</span></li>
            <li>Email: <span>{{currentUser.RoleId==5?currentLiveChatAppts.ClientEmail:currentLiveChatAppts.CounsellerEmail}}</span></li>
            <li>Phone: <span>{{currentUser.RoleId==5?currentLiveChatAppts.ClientMobileNo:currentLiveChatAppts.CounsellerMobileNo}}</span></li>
            <li>Post Code: <span>{{currentUser.RoleId==5?currentLiveChatAppts.ClientPostcode:currentLiveChatAppts.CounsellerPostcode}}</span></li>
            <li>DOB: <span>{{currentLiveChatAppts.clientDob}}</span></li>
          </ul>
          <ul *ngIf=currentLiveChatAppts.IsForFamilyMember>
            <li><span>{{currentLiveChatAppts.FMFirstName}}</span></li>
            <li>Email: <span>{{currentLiveChatAppts.FMEmail}}</span></li>
            <li>Phone: <span>{{currentLiveChatAppts.FMPhone}}</span></li>
            <li>DOB: <span>{{currentLiveChatAppts.FmailyDob}}</span></li>
          </ul>
        </div>
        <div  *ngIf="Chatisstatrdendedstop" >
          <div class="modal" style="display: block!important;background: rgba(255, 255, 255, 0.5);">
           <div class="modal-dialog modal-dialog-centered">
             <div class="modal-content">
               <div class="modal-body">
                   <div class="cancel-apntmnt">
                       <p>The person you are speaking to has left the chat room. You may now close this window. If you were not expecting your session to end, please return to the Home screen and re-join.</p>
                       <div class="btn-grp" style="width: 50% !important;padding-left: 28% !important;">
                           <a href="javascript:;" (click)="YesmodelchatendOk()" class="btn appoint-btn" data-dismiss="modal">OK</a>
                       </div>
                       <!-- <div class="btn-grp" style="width: 48% !important;">
                           <a href="javascript:;" (click)="Cancelmodelchatend()" class="cancel-text-link" data-dismiss="modal" >No</a>
                       </div> -->
                   </div>
               </div>
             </div>
           </div>
       </div>

       </div>
       <div  *ngIf="Chatisdisconectnternet" >
        <div class="modal" style="display: block!important;background: rgba(255, 255, 255, 0.5);">
         <div class="modal-dialog modal-dialog-centered">
           <div class="modal-content">
             <div class="modal-body">
                 <div class="cancel-apntmnt">
                     <p>The person you are speaking to has left the chat room. You may now close this window. If you were not expecting your session to end, please return to the Home screen and re-join.</p>
                     <div class="btn-grp" style="width: 50% !important;padding-left: 28% !important;">
                         <a href="javascript:;" (click)="YesmodelchatendOkInternet()" class="btn appoint-btn" data-dismiss="modal">OK</a>
                     </div>
                     <!-- <div class="btn-grp" style="width: 48% !important;">
                         <a href="javascript:;" (click)="Cancelmodelchatend()" class="cancel-text-link" data-dismiss="modal" >No</a>
                     </div> -->
                 </div>
             </div>
           </div>
         </div>
      </div>
      </div>
       <div  *ngIf="Chatappoitmettimeisover" >
        <div class="modal" style="display: block!important;background: rgba(255, 255, 255, 0.5);">
         <div class="modal-dialog modal-dialog-centered">
           <div class="modal-content">
             <div class="modal-body">
                 <div class="cancel-apntmnt">
                     <p style="text-align: center !important">Your appointment time is over. So chat is ended</p>
                     <div class="btn-grp" style="width: 50% !important;padding-left: 28% !important;">
                         <a href="javascript:;" (click)="YesmodelchatendOk()" class="btn appoint-btn" data-dismiss="modal">OK</a>
                     </div>
                     <!-- <div class="btn-grp" style="width: 48% !important;">
                         <a href="javascript:;" (click)="Cancelmodelchatend()" class="cancel-text-link" data-dismiss="modal" >No</a>
                     </div> -->
                 </div>
             </div>
           </div>
         </div>
      </div>

      </div>
      </div>
    </div>
  </div>
